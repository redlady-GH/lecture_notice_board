# 게시글 삭제 기능 보안 점검 보고서

## 1. 개요
현재 `lecture_notice` 프로젝트의 게시글 삭제 기능(`/delete/<int:id>`)에 대한 보안 취약점을 분석하고, 이를 개선하기 위한 방안을 제시합니다. 현재 구현은 GET 요청을 통해 상태 변경(삭제)을 수행하고 있어 보안상 취약한 상태입니다.

## 2. 현황 분석

### 2.1 현재 코드
- **Backend (`app.py`)**:
  ```python
  @app.route('/delete/<int:id>')
  def delete(id):
      # ... 삭제 로직 ...
  ```
  - HTTP Method 제한이 없어 기본값인 `GET` 요청을 처리합니다.
  - 로그인 세션(`logged_in`)만 확인합니다.

- **Frontend (`templates/admin.html`)**:
  ```html
  <a href="/delete/{{ post.id }}" ... onclick="return confirm(...)">삭제</a>
  ```
  - 단순 하이퍼링크(`<a>`)를 사용하여 GET 요청을 보냅니다.
  - 자바스크립트 `confirm`은 사용자 실수 방지용일 뿐, 보안 장치가 아닙니다.

### 2.2 주요 취약점

#### A. CSRF (Cross-Site Request Forgery, 사이트 간 요청 위조)
- **위험성**: 공격자가 관리자에게 악성 링크나 이미지가 포함된 이메일/웹페이지를 보낼 수 있습니다.
- **시나리오**: 관리자가 로그인된 상태에서 `<img src="http://n100.local/delete/5">` 태그가 포함된 페이지를 열람하기만 해도, 브라우저는 자동으로 해당 URL로 GET 요청을 보내 게시글 5번이 삭제됩니다.

#### B. HTTP Method 의미론 위반
- **위험성**: HTTP 표준에서 `GET`은 데이터 조회(Safe Method)에만 사용되어야 하며, 서버의 상태를 변경(삭제, 수정)해서는 안 됩니다.
- **시나리오**: 웹 크롤러나 브라우저의 "미리 읽기(Prefetch)" 기능이 링크를 방문하여 의도치 않게 게시글을 삭제할 수 있습니다.

#### C. 세션 하이재킹 (Session Hijacking)
- **위험성**: 공격자가 관리자의 세션 쿠키를 탈취한 경우, URL만 알면 즉시 삭제가 가능합니다. (단, 이는 POST로 변경해도 쿠키가 탈취되면 동일하지만, CSRF 공격에는 훨씬 취약합니다.)

---

## 3. 개선 방안 비교

| 방안 | 설명 | 보안 수준 | 구현 난이도 | 비고 |
| :--- | :--- | :---: | :---: | :--- |
| **1. POST Method 전환** | `<a>` 태그 대신 `<form method="POST">` 사용 | 중 | 하 | 기본적인 실수/크롤러 방지 |
| **2. CSRF Token 적용** | Form 전송 시 난수 토큰 검증 | 상 | 중 | **권장 (표준)** |
| **3. 재인증 (Re-auth)** | 삭제 시 비밀번호 재입력 요구 | 최상 | 상 | 중요 데이터 보호에 적합 |

---

## 4. 추천 구현 가이드 (Step-by-Step)

가장 효율적이고 표준적인 방법인 "**POST Method 전환 + CSRF 방어**"를 단계별로 제안합니다. 현재 프로젝트 규모상 외부 라이브러리(`Flask-WTF`) 도입이 부담스럽다면, **방법 1**(POST 전환)만이라도 즉시 적용해야 합니다.

### [1단계] 즉시 적용: POST Method로 전환 (필수)

GET 요청을 차단하고 POST 요청만 허용하도록 변경합니다.

**Backend (`app.py`) 수정:**
```python
# methods=['POST'] 추가하여 GET 요청 차단
@app.route('/delete/<int:id>', methods=['POST'])
def delete(id):
    if 'logged_in' not in session:
        return redirect(url_for('login'))
    
    # ... 기존 삭제 로직 ...
```

**Frontend (`templates/admin.html`) 수정:**
```html
<!-- 기존 <a> 태그 삭제 -->
<!-- <a href="/delete/{{ post.id }}" ...>삭제</a> -->

<!-- Form 형식으로 변경 -->
<form action="{{ url_for('delete', id=post.id) }}" method="post" style="display:inline;">
    <button type="submit" class="delete-btn" onclick="return confirm('정말 삭제하시겠습니까?');">
        삭제
    </button>
</form>
```

### [2단계] 권장 적용: CSRF Token 도입

Flask에는 `Flask-WTF`라는 훌륭한 확장이 있지만, 의존성을 늘리지 않고 간단히 구현하려면 세션에 난수를 저장하여 검증할 수 있습니다.

1. **로그인 시**: `session['csrf_token'] = os.urandom(24).hex()` 생성.
2. **Form**: `<input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">` 추가.
3. **삭제 함수**: `request.form['csrf_token'] == session['csrf_token']` 검증.

## 5. 결론

현재의 GET 방식 삭제 구현은 **보안상 매우 취약**하며, 실수로 인한 데이터 손실 가능성도 높습니다.

1. **최소 조치**: 즉시 `app.py`와 `admin.html`을 수정하여 **POST 방식**으로 변경하십시오.
2. **추가 조치**: 프로젝트의 중요도가 높아진다면 `Flask-WTF`를 도입하여 CSRF Token을 적용하는 것이 좋습니다.