# [학습자료] 네트워크 기초: mDNS와 .local 도메인 이해하기

이 문서는 로컬 개발 환경에서 서버에 접속할 때 IP 주소 대신 **도메인 이름**(`myserver.local`)을 사용하는 원리(mDNS)를 이해하고, 흔히 발생하는 **접속 오류**(IPv6 충돌)를 해결하는 과정을 다룹니다.

## 1. mDNS란 무엇인가요?

### 1.1. "IP 주소 외우기 귀찮아요"
서버를 개발하다 보면 `192.168.0.15` 같은 IP 주소를 매번 확인하고 입력하는 것이 번거롭습니다. 게다가 공유기가 재부팅되면 IP가 바뀌기도 합니다.
이때 사용하는 것이 **mDNS (Multicast DNS)** 기술입니다.

*   **DNS**: 인터넷 전화번호부. `google.com` -> `142.250.x.x` (전용 서버 필요)
*   **mDNS**: "여기 `myserver.local`인 사람 있어?"라고 소리치면(Broadcast), 해당 기기가 "저요! 제 IP는 `192.168.0.15`입니다!"라고 대답하는 방식. (전용 서버 불필요)

리눅스에서는 **Avahi**, 맥에서는 **Bonjour**라는 프로그램이 이 역할을 담당합니다.

---

## 2. 문제 상황: "SSH는 되는데 웹은 안 돼요"

개발자들을 가장 혼란스럽게 만드는 상황이 있습니다.

*   ✅ **SSH 접속 성공**: `ssh user@myserver.local` (잘 됨)
*   ✅ **IP 웹 접속 성공**: `http://192.168.0.15` (잘 됨)
*   ❌ **도메인 웹 접속 실패**: `http://myserver.local` (연결 거부됨)

### 2.1. 왜 이런 일이 발생할까요?
범인은 **IPv6**와 **Docker** 사이의 소통 부재입니다.

1.  **Avahi의 과잉 친절**: 서버의 Avahi는 `myserver.local`을 찾는 요청에 대해 **IPv4 주소**와 **IPv6 주소**를 모두 알려줍니다.
2.  **브라우저의 IPv6 편애**: 최신 브라우저(Chrome, Safari)는 IPv6 주소를 받으면 **IPv6로 먼저 접속**을 시도합니다.
3.  **Docker의 무관심**: 우리가 띄운 웹 서버(Docker 컨테이너)는 기본적으로 **IPv4**(`0.0.0.0`)만 기다리고 있습니다. IPv6(`::`)로 들어오는 노크는 듣지 못합니다.
4.  **SSH는 왜 될까?**: SSH 서버(`sshd`)는 호스트 OS에 직접 설치되어 있고, 기본적으로 IPv4/IPv6를 모두 지원하기 때문에 접속이 됩니다.

---

## 3. 해결책: "IPv4만 쓰자" (Avahi 설정 변경)

가장 확실한 해결책은 mDNS가 **IPv4 주소만 알려주도록** 설정하는 것입니다.

### 3.1. 설정 파일 수정
서버 터미널에서 `/etc/avahi/avahi-daemon.conf` 파일을 엽니다.

```bash
sudo nano /etc/avahi/avahi-daemon.conf
```

`[server]` 섹션에서 `use-ipv6` 옵션을 찾아 `no`로 변경합니다.

```ini
[server]
use-ipv4=yes
use-ipv6=no   <-- 여기를 yes에서 no로 변경
```

### 3.2. 서비스 재시작
설정을 적용하기 위해 Avahi 데몬을 재시작합니다.

```bash
sudo systemctl restart avahi-daemon
```

이제 클라이언트(내 PC)는 `myserver.local`을 찾을 때 IPv4 주소만 받게 되며, Docker 컨테이너와 정상적으로 통신할 수 있습니다.

---

## 4. 요약

| 구분 | 설명 |
| :--- | :--- |
| **mDNS** | 로컬 네트워크에서 IP 대신 `.local` 도메인을 쓰게 해주는 기술 |
| **문제 원인** | 브라우저는 IPv6로 접속하려는데, Docker는 IPv4만 열어둠 |
| **해결 방법** | Avahi 설정에서 IPv6 광고를 끄고 IPv4만 사용하도록 강제 |

네트워크 문제는 눈에 보이지 않아 디버깅이 어렵습니다. "**어떤 프로토콜(IPv4/IPv6)로 통신하고 있는가?**"를 의심해보는 습관이 중요합니다.
